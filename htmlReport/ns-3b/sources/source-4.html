


<!DOCTYPE html>
<html id="htmlId">
<head>
  <meta http-equiv="Content-Type" content="text/html;charset=UTF-8"> 
  <title>Coverage Report > JabRefFrame</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">org.jabref.gui.frame</a>
</div>

<h1>Coverage Summary for Class: JabRefFrame (org.jabref.gui.frame)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Branch, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">JabRefFrame</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/36)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/89)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/221)
  </span>
</td>
</tr>
  <tr>
    <td class="name">JabRefFrame$1</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JabRefFrame$CloseAction</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JabRefFrame$CloseAllDatabaseAction</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JabRefFrame$CloseDatabaseAction</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/11)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JabRefFrame$CloseOthersDatabaseAction</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/4)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JabRefFrame$OpenDatabaseFolder</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/3)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/8)
  </span>
</td>
  </tr>
  <tr>
    <td class="name">JabRefFrame$PanelMode</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/1)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/51)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/101)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    0%
  </span>
  <span class="absValue">
    (0/258)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package org.jabref.gui.frame;
&nbsp;
&nbsp;import java.io.IOException;
&nbsp;import java.nio.file.Path;
&nbsp;import java.util.List;
&nbsp;import java.util.Objects;
&nbsp;import java.util.Optional;
&nbsp;import java.util.function.Supplier;
&nbsp;
&nbsp;import javafx.application.Platform;
&nbsp;import javafx.beans.InvalidationListener;
&nbsp;import javafx.beans.binding.Bindings;
&nbsp;import javafx.beans.property.ObjectProperty;
&nbsp;import javafx.beans.property.SimpleBooleanProperty;
&nbsp;import javafx.beans.property.SimpleObjectProperty;
&nbsp;import javafx.beans.value.ObservableValue;
&nbsp;import javafx.collections.ListChangeListener;
&nbsp;import javafx.collections.ObservableList;
&nbsp;import javafx.event.Event;
&nbsp;import javafx.geometry.Orientation;
&nbsp;import javafx.scene.control.ContextMenu;
&nbsp;import javafx.scene.control.SeparatorMenuItem;
&nbsp;import javafx.scene.control.SplitPane;
&nbsp;import javafx.scene.control.Tab;
&nbsp;import javafx.scene.control.TabPane;
&nbsp;import javafx.scene.input.KeyEvent;
&nbsp;import javafx.scene.layout.BorderPane;
&nbsp;import javafx.scene.layout.VBox;
&nbsp;import javafx.stage.Stage;
&nbsp;
&nbsp;import org.jabref.gui.ClipBoardManager;
&nbsp;import org.jabref.gui.DialogService;
&nbsp;import org.jabref.gui.LibraryTab;
&nbsp;import org.jabref.gui.LibraryTabContainer;
&nbsp;import org.jabref.gui.StateManager;
&nbsp;import org.jabref.gui.actions.ActionFactory;
&nbsp;import org.jabref.gui.actions.ActionHelper;
&nbsp;import org.jabref.gui.actions.SimpleCommand;
&nbsp;import org.jabref.gui.actions.StandardActions;
&nbsp;import org.jabref.gui.desktop.os.NativeDesktop;
&nbsp;import org.jabref.gui.entryeditor.EntryEditor;
&nbsp;import org.jabref.gui.importer.NewEntryAction;
&nbsp;import org.jabref.gui.importer.actions.OpenDatabaseAction;
&nbsp;import org.jabref.gui.keyboard.KeyBinding;
&nbsp;import org.jabref.gui.libraryproperties.LibraryPropertiesAction;
&nbsp;import org.jabref.gui.preferences.GuiPreferences;
&nbsp;import org.jabref.gui.push.GuiPushToApplicationCommand;
&nbsp;import org.jabref.gui.search.GlobalSearchBar;
&nbsp;import org.jabref.gui.search.SearchType;
&nbsp;import org.jabref.gui.sidepane.SidePane;
&nbsp;import org.jabref.gui.sidepane.SidePaneType;
&nbsp;import org.jabref.gui.undo.CountingUndoManager;
&nbsp;import org.jabref.gui.undo.RedoAction;
&nbsp;import org.jabref.gui.undo.UndoAction;
&nbsp;import org.jabref.gui.util.BindingsHelper;
&nbsp;import org.jabref.gui.welcome.WelcomeTab;
&nbsp;import org.jabref.logic.UiCommand;
&nbsp;import org.jabref.logic.ai.AiService;
&nbsp;import org.jabref.logic.git.util.GitHandlerRegistry;
&nbsp;import org.jabref.logic.journals.JournalAbbreviationRepository;
&nbsp;import org.jabref.logic.util.BuildInfo;
&nbsp;import org.jabref.logic.util.TaskExecutor;
&nbsp;import org.jabref.model.database.BibDatabaseContext;
&nbsp;import org.jabref.model.entry.BibEntryTypesManager;
&nbsp;import org.jabref.model.entry.types.StandardEntryType;
&nbsp;import org.jabref.model.util.FileUpdateMonitor;
&nbsp;
&nbsp;import com.airhacks.afterburner.injection.Injector;
&nbsp;import com.tobiasdiez.easybind.EasyBind;
&nbsp;import com.tobiasdiez.easybind.EasyObservableList;
&nbsp;import com.tobiasdiez.easybind.Subscription;
&nbsp;import org.jspecify.annotations.NonNull;
&nbsp;import org.slf4j.Logger;
&nbsp;import org.slf4j.LoggerFactory;
&nbsp;
&nbsp;import static org.jabref.gui.actions.ActionHelper.needsSavedLocalDatabase;
&nbsp;
&nbsp;/**
&nbsp; * Represents the inner frame of the JabRef window
&nbsp; */
&nbsp;public class JabRefFrame extends BorderPane implements LibraryTabContainer, UiMessageHandler {
&nbsp;    /**
&nbsp;     * Defines the different modes that the tab can operate in
&nbsp;     */
<b class="nc">&nbsp;    private enum PanelMode { MAIN_TABLE, MAIN_TABLE_AND_ENTRY_EDITOR }</b>
&nbsp;
&nbsp;    public static final String FRAME_TITLE = &quot;JabRef&quot;;
&nbsp;
<b class="nc">&nbsp;    private static final Logger LOGGER = LoggerFactory.getLogger(JabRefFrame.class);</b>
&nbsp;
&nbsp;    private final GuiPreferences preferences;
&nbsp;    private final AiService aiService;
&nbsp;    private final GlobalSearchBar globalSearchBar;
&nbsp;
&nbsp;    private final FileHistoryMenu fileHistory;
&nbsp;
&nbsp;    @SuppressWarnings({&quot;FieldCanBeLocal&quot;}) private EasyObservableList&lt;BibDatabaseContext&gt; openDatabaseList;
&nbsp;
&nbsp;    private final Stage mainStage;
&nbsp;    private final StateManager stateManager;
&nbsp;    private final CountingUndoManager undoManager;
&nbsp;    private final DialogService dialogService;
&nbsp;    private final FileUpdateMonitor fileUpdateMonitor;
&nbsp;    private final BibEntryTypesManager entryTypesManager;
&nbsp;    private final ClipBoardManager clipBoardManager;
&nbsp;    private final TaskExecutor taskExecutor;
&nbsp;    private final GitHandlerRegistry gitHandlerRegistry;
&nbsp;
&nbsp;    private final JabRefFrameViewModel viewModel;
&nbsp;    private final GuiPushToApplicationCommand pushToApplicationCommand;
<b class="nc">&nbsp;    private final SplitPane horizontalSplit = new SplitPane();</b>
&nbsp;    private final SidePane sidePane;
<b class="nc">&nbsp;    private final SplitPane verticalSplit = new SplitPane();</b>
<b class="nc">&nbsp;    private final TabPane tabbedPane = new TabPane();</b>
&nbsp;    private final EntryEditor entryEditor;
<b class="nc">&nbsp;    private final ObjectProperty&lt;PanelMode&gt; panelMode = new SimpleObjectProperty&lt;&gt;(PanelMode.MAIN_TABLE);</b>
&nbsp;
&nbsp;    // We need to keep a reference to the subscription, otherwise the binding gets garbage collected
&nbsp;    private Subscription horizontalDividerSubscription;
&nbsp;    private Subscription verticalDividerSubscription;
&nbsp;
&nbsp;    public JabRefFrame(Stage mainStage,
&nbsp;                       DialogService dialogService,
&nbsp;                       FileUpdateMonitor fileUpdateMonitor,
&nbsp;                       GuiPreferences preferences,
&nbsp;                       AiService aiService,
&nbsp;                       StateManager stateManager,
&nbsp;                       CountingUndoManager undoManager,
&nbsp;                       BibEntryTypesManager entryTypesManager,
&nbsp;                       ClipBoardManager clipBoardManager,
&nbsp;                       TaskExecutor taskExecutor,
<b class="nc">&nbsp;                       GitHandlerRegistry gitHandlerRegistry) {</b>
<b class="nc">&nbsp;        this.mainStage = mainStage;</b>
<b class="nc">&nbsp;        this.dialogService = dialogService;</b>
<b class="nc">&nbsp;        this.fileUpdateMonitor = fileUpdateMonitor;</b>
<b class="nc">&nbsp;        this.preferences = preferences;</b>
<b class="nc">&nbsp;        this.aiService = aiService;</b>
<b class="nc">&nbsp;        this.stateManager = stateManager;</b>
<b class="nc">&nbsp;        this.undoManager = undoManager;</b>
<b class="nc">&nbsp;        this.entryTypesManager = entryTypesManager;</b>
<b class="nc">&nbsp;        this.clipBoardManager = clipBoardManager;</b>
<b class="nc">&nbsp;        this.taskExecutor = taskExecutor;</b>
<b class="nc">&nbsp;        this.gitHandlerRegistry = gitHandlerRegistry;</b>
&nbsp;
<b class="nc">&nbsp;        setId(&quot;frame&quot;);</b>
&nbsp;
&nbsp;        // Create components
<b class="nc">&nbsp;        this.viewModel = new JabRefFrameViewModel(</b>
&nbsp;                preferences,
&nbsp;                aiService,
&nbsp;                stateManager,
&nbsp;                dialogService,
&nbsp;                this,
&nbsp;                this::getOpenDatabaseAction,
&nbsp;                entryTypesManager,
&nbsp;                fileUpdateMonitor,
&nbsp;                undoManager,
&nbsp;                clipBoardManager,
&nbsp;                taskExecutor);
<b class="nc">&nbsp;        Injector.setModelOrService(UiMessageHandler.class, viewModel);</b>
&nbsp;
<b class="nc">&nbsp;        FrameDndHandler frameDndHandler = new FrameDndHandler(</b>
&nbsp;                tabbedPane,
<b class="nc">&nbsp;                mainStage::getScene,</b>
&nbsp;                this::getOpenDatabaseAction,
&nbsp;                stateManager);
&nbsp;
<b class="nc">&nbsp;        this.globalSearchBar = new GlobalSearchBar(</b>
&nbsp;                this,
&nbsp;                stateManager,
&nbsp;                this.preferences,
&nbsp;                undoManager,
&nbsp;                dialogService,
&nbsp;                SearchType.NORMAL_SEARCH);
&nbsp;
<b class="nc">&nbsp;        this.entryEditor = new EntryEditor(this::getCurrentLibraryTab,</b>
&nbsp;                // Actions are recreated here since this avoids passing more parameters and the amount of additional memory consumption is neglegtable.
&nbsp;                new UndoAction(this::getCurrentLibraryTab, undoManager, dialogService, stateManager),
&nbsp;                new RedoAction(this::getCurrentLibraryTab, undoManager, dialogService, stateManager));
<b class="nc">&nbsp;        Injector.setModelOrService(EntryEditor.class, entryEditor);</b>
&nbsp;
<b class="nc">&nbsp;        this.sidePane = new SidePane(</b>
&nbsp;                this,
&nbsp;                this.preferences,
<b class="nc">&nbsp;                Injector.instantiateModelOrService(JournalAbbreviationRepository.class),</b>
&nbsp;                taskExecutor,
&nbsp;                dialogService,
&nbsp;                aiService,
&nbsp;                stateManager,
&nbsp;                entryEditor,
&nbsp;                fileUpdateMonitor,
&nbsp;                entryTypesManager,
&nbsp;                clipBoardManager,
&nbsp;                undoManager);
&nbsp;
<b class="nc">&nbsp;        this.pushToApplicationCommand = new GuiPushToApplicationCommand(</b>
&nbsp;                stateManager,
&nbsp;                dialogService,
&nbsp;                this.preferences,
&nbsp;                taskExecutor);
&nbsp;
<b class="nc">&nbsp;        this.fileHistory = new FileHistoryMenu(</b>
<b class="nc">&nbsp;                this.preferences.getLastFilesOpenedPreferences().getFileHistory(),</b>
&nbsp;                dialogService,
<b class="nc">&nbsp;                getOpenDatabaseAction());</b>
&nbsp;
<b class="nc">&nbsp;        fileHistory.disableProperty().bind(Bindings.isEmpty(fileHistory.getItems()));</b>
&nbsp;
<b class="nc">&nbsp;        this.setOnKeyTyped(key -&gt; {</b>
<b class="nc">&nbsp;            if (this.fileHistory.isShowing()) {</b>
<b class="nc">&nbsp;                if (this.fileHistory.openFileByKey(key)) {</b>
<b class="nc">&nbsp;                    this.fileHistory.getParentMenu().hide();</b>
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        initLayout();</b>
<b class="nc">&nbsp;        initKeyBindings();</b>
<b class="nc">&nbsp;        frameDndHandler.initDragAndDrop();</b>
<b class="nc">&nbsp;        initBindings();</b>
&nbsp;    }
&nbsp;
&nbsp;    private void initLayout() {
<b class="nc">&nbsp;        MainToolBar mainToolBar = new MainToolBar(</b>
&nbsp;                this,
&nbsp;                pushToApplicationCommand,
&nbsp;                globalSearchBar,
&nbsp;                dialogService,
&nbsp;                stateManager,
&nbsp;                preferences,
&nbsp;                aiService,
&nbsp;                fileUpdateMonitor,
&nbsp;                taskExecutor,
&nbsp;                entryTypesManager,
&nbsp;                clipBoardManager,
&nbsp;                undoManager);
&nbsp;
<b class="nc">&nbsp;        MainMenu mainMenu = new MainMenu(</b>
&nbsp;                this,
&nbsp;                fileHistory,
&nbsp;                sidePane,
&nbsp;                pushToApplicationCommand,
&nbsp;                preferences,
&nbsp;                stateManager,
&nbsp;                fileUpdateMonitor,
&nbsp;                taskExecutor,
&nbsp;                dialogService,
<b class="nc">&nbsp;                Injector.instantiateModelOrService(JournalAbbreviationRepository.class),</b>
&nbsp;                entryTypesManager,
&nbsp;                undoManager,
&nbsp;                clipBoardManager,
&nbsp;                this::getOpenDatabaseAction,
&nbsp;                aiService,
&nbsp;                entryEditor,
&nbsp;                gitHandlerRegistry);
&nbsp;
<b class="nc">&nbsp;        VBox head = new VBox(mainMenu, mainToolBar);</b>
<b class="nc">&nbsp;        head.setSpacing(0d);</b>
<b class="nc">&nbsp;        setTop(head);</b>
&nbsp;
<b class="nc">&nbsp;        verticalSplit.getItems().addAll(tabbedPane);</b>
<b class="nc">&nbsp;        verticalSplit.setOrientation(Orientation.VERTICAL);</b>
<b class="nc">&nbsp;        updateEditorPane();</b>
&nbsp;
<b class="nc">&nbsp;        horizontalSplit.getItems().addAll(verticalSplit);</b>
<b class="nc">&nbsp;        horizontalSplit.setOrientation(Orientation.HORIZONTAL);</b>
&nbsp;
<b class="nc">&nbsp;        SplitPane.setResizableWithParent(sidePane, false);</b>
<b class="nc">&nbsp;        sidePane.widthProperty().addListener(_ -&gt; updateSidePane());</b>
<b class="nc">&nbsp;        sidePane.getChildren().addListener((InvalidationListener) _ -&gt; updateSidePane());</b>
<b class="nc">&nbsp;        updateSidePane();</b>
<b class="nc">&nbsp;        setCenter(horizontalSplit);</b>
&nbsp;    }
&nbsp;
&nbsp;    private void updateSidePane() {
<b class="nc">&nbsp;        if (sidePane.getChildren().isEmpty()) {</b>
<b class="nc">&nbsp;            if (horizontalDividerSubscription != null) {</b>
<b class="nc">&nbsp;                horizontalDividerSubscription.unsubscribe();</b>
&nbsp;            }
<b class="nc">&nbsp;            horizontalSplit.getItems().remove(sidePane);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            if (!horizontalSplit.getItems().contains(sidePane)) {</b>
<b class="nc">&nbsp;                horizontalSplit.getItems().addFirst(sidePane);</b>
<b class="nc">&nbsp;                updateHorizontalDividerPosition();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void updateEditorPane() {
<b class="nc">&nbsp;        if (panelMode.get() == PanelMode.MAIN_TABLE) {</b>
<b class="nc">&nbsp;            if (verticalDividerSubscription != null) {</b>
<b class="nc">&nbsp;                verticalDividerSubscription.unsubscribe();</b>
&nbsp;            }
<b class="nc">&nbsp;            verticalSplit.getItems().remove(entryEditor);</b>
&nbsp;        } else {
<b class="nc">&nbsp;            if (!verticalSplit.getItems().contains(entryEditor)) {</b>
<b class="nc">&nbsp;                verticalSplit.getItems().addLast(entryEditor);</b>
<b class="nc">&nbsp;                updateVerticalDividerPosition();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void updateHorizontalDividerPosition() {
<b class="nc">&nbsp;        if (mainStage.isShowing() &amp;&amp; !sidePane.getChildren().isEmpty()) {</b>
<b class="nc">&nbsp;            horizontalSplit.setDividerPositions(preferences.getGuiPreferences().getHorizontalDividerPosition() / horizontalSplit.getWidth());</b>
<b class="nc">&nbsp;            horizontalDividerSubscription = EasyBind.valueAt(horizontalSplit.getDividers(), 0)</b>
<b class="nc">&nbsp;                                                    .mapObservable(SplitPane.Divider::positionProperty)</b>
<b class="nc">&nbsp;                                                    .listenToValues((_, newValue) -&gt; preferences.getGuiPreferences().setHorizontalDividerPosition(newValue.doubleValue()));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public void updateVerticalDividerPosition() {
<b class="nc">&nbsp;        if (mainStage.isShowing() &amp;&amp; panelMode.get() == PanelMode.MAIN_TABLE_AND_ENTRY_EDITOR) {</b>
<b class="nc">&nbsp;            verticalSplit.setDividerPositions(preferences.getGuiPreferences().getVerticalDividerPosition());</b>
<b class="nc">&nbsp;            verticalDividerSubscription = EasyBind.valueAt(verticalSplit.getDividers(), 0)</b>
<b class="nc">&nbsp;                                                  .mapObservable(SplitPane.Divider::positionProperty)</b>
<b class="nc">&nbsp;                                                  .listenToValues((_, newValue) -&gt; preferences.getGuiPreferences().setVerticalDividerPosition(newValue.doubleValue()));</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private void initKeyBindings() {
<b class="nc">&nbsp;        addEventFilter(KeyEvent.KEY_PRESSED, event -&gt; {</b>
<b class="nc">&nbsp;            Optional&lt;KeyBinding&gt; keyBinding = preferences.getKeyBindingRepository().mapToKeyBinding(event);</b>
<b class="nc">&nbsp;            if (keyBinding.isPresent()) {</b>
<b class="nc">&nbsp;                switch (keyBinding.get()) {</b>
&nbsp;                    case FOCUS_ENTRY_TABLE:
<b class="nc">&nbsp;                        getCurrentLibraryTab().getMainTable().requestFocus();</b>
<b class="nc">&nbsp;                        event.consume();</b>
&nbsp;                        break;
&nbsp;                    case FOCUS_GROUP_LIST:
<b class="nc">&nbsp;                        sidePane.getSidePaneComponent(SidePaneType.GROUPS).requestFocus();</b>
<b class="nc">&nbsp;                        event.consume();</b>
&nbsp;                        break;
&nbsp;                    case NEXT_LIBRARY:
<b class="nc">&nbsp;                        tabbedPane.getSelectionModel().selectNext();</b>
<b class="nc">&nbsp;                        event.consume();</b>
&nbsp;                        break;
&nbsp;                    case PREVIOUS_LIBRARY:
<b class="nc">&nbsp;                        tabbedPane.getSelectionModel().selectPrevious();</b>
<b class="nc">&nbsp;                        event.consume();</b>
&nbsp;                        break;
&nbsp;                    case SEARCH:
<b class="nc">&nbsp;                        globalSearchBar.requestFocus();</b>
&nbsp;                        break;
&nbsp;                    case OPEN_GLOBAL_SEARCH_DIALOG:
<b class="nc">&nbsp;                        globalSearchBar.openGlobalSearchDialog();</b>
&nbsp;                        break;
&nbsp;                    case NEW_ARTICLE:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.Article, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case NEW_BOOK:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.Book, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case NEW_INBOOK:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.InBook, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case NEW_MASTERSTHESIS:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.MastersThesis, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case NEW_PHDTHESIS:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.PhdThesis, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case NEW_PROCEEDINGS:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.Proceedings, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case NEW_TECHREPORT:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.TechReport, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case NEW_UNPUBLISHED:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.Unpublished, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case NEW_INPROCEEDINGS:
<b class="nc">&nbsp;                        new NewEntryAction(StandardEntryType.InProceedings, this::getCurrentLibraryTab, dialogService, preferences, stateManager).execute();</b>
&nbsp;                        break;
&nbsp;                    case BACK:
<b class="nc">&nbsp;                        Optional.ofNullable(getCurrentLibraryTab()).ifPresent(LibraryTab::back);</b>
<b class="nc">&nbsp;                        event.consume();</b>
&nbsp;                        break;
&nbsp;                    case FORWARD:
<b class="nc">&nbsp;                        Optional.ofNullable(getCurrentLibraryTab()).ifPresent(LibraryTab::forward);</b>
<b class="nc">&nbsp;                        event.consume();</b>
&nbsp;                        break;
&nbsp;                    default:
&nbsp;                }
&nbsp;            }
&nbsp;        });
&nbsp;    }
&nbsp;
&nbsp;    private void initBindings() {
<b class="nc">&nbsp;        BindingsHelper.bindContentFiltered(tabbedPane.getTabs(), stateManager.getOpenDatabases(), LibraryTab.class::isInstance);</b>
&nbsp;
&nbsp;        // the binding for stateManager.activeDatabaseProperty() is at org.jabref.gui.LibraryTab.onDatabaseLoadingSucceed
&nbsp;
&nbsp;        // Subscribe to the search
<b class="nc">&nbsp;        EasyBind.subscribe(stateManager.activeSearchQuery(SearchType.NORMAL_SEARCH), query -&gt; {</b>
<b class="nc">&nbsp;            if (getCurrentLibraryTab() != null) {</b>
<b class="nc">&nbsp;                getCurrentLibraryTab().searchQueryProperty().set(query);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;        // Wait for the scene to be created, otherwise focusOwnerProperty is not provided
<b class="nc">&nbsp;        Platform.runLater(() -&gt; stateManager.focusOwnerProperty().bind(</b>
<b class="nc">&nbsp;                EasyBind.map(mainStage.getScene().focusOwnerProperty(), Optional::ofNullable)));</b>
&nbsp;
<b class="nc">&nbsp;        EasyBind.subscribe(tabbedPane.getSelectionModel().selectedItemProperty(), selectedTab -&gt; {</b>
<b class="nc">&nbsp;            if (selectedTab instanceof LibraryTab libraryTab) {</b>
<b class="nc">&nbsp;                stateManager.setActiveDatabase(libraryTab.getBibDatabaseContext());</b>
<b class="nc">&nbsp;                stateManager.activeTabProperty().set(Optional.of(libraryTab));</b>
<b class="nc">&nbsp;                stateManager.setSelectedEntries(libraryTab.getSelectedEntries());</b>
&nbsp;
&nbsp;                // Update active search query when switching between databases
<b class="nc">&nbsp;                if (preferences.getSearchPreferences().shouldKeepSearchString()) {</b>
<b class="nc">&nbsp;                    libraryTab.searchQueryProperty().set(stateManager.activeSearchQuery(SearchType.NORMAL_SEARCH).get());</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    stateManager.activeSearchQuery(SearchType.NORMAL_SEARCH).set(libraryTab.searchQueryProperty().get());</b>
&nbsp;                }
<b class="nc">&nbsp;                stateManager.searchResultSize(SearchType.NORMAL_SEARCH).bind(libraryTab.resultSizeProperty());</b>
<b class="nc">&nbsp;                globalSearchBar.setAutoCompleter(libraryTab.getAutoCompleter());</b>
&nbsp;
&nbsp;                // Listen for auto-completer changes after real context is loaded
<b class="nc">&nbsp;                libraryTab.setAutoCompleterChangedListener(() -&gt; globalSearchBar.setAutoCompleter(libraryTab.getAutoCompleter()));</b>
&nbsp;
&nbsp;                // [impl-&gt;req~maintable.focus~1]
<b class="nc">&nbsp;                Platform.runLater(() -&gt; libraryTab.getMainTable().requestFocus());</b>
&nbsp;
&nbsp;                // Set window title dynamically
<b class="nc">&nbsp;                mainStage.titleProperty().bind(Bindings.createStringBinding(</b>
<b class="nc">&nbsp;                        () -&gt; libraryTab.textProperty().getValue() + &quot; â€“ &quot; + FRAME_TITLE, // not a minus, but codepoint 2013</b>
<b class="nc">&nbsp;                        libraryTab.textProperty()));</b>
&nbsp;            } else {
&nbsp;                // Check if the previously active database was closed
<b class="nc">&nbsp;                if (stateManager.getActiveDatabase().isPresent()) {</b>
<b class="nc">&nbsp;                    String activeUID = stateManager.getActiveDatabase().get().getUid();</b>
<b class="nc">&nbsp;                    boolean wasClosed = tabbedPane.getTabs().stream()</b>
<b class="nc">&nbsp;                                                  .filter(tab -&gt; tab instanceof LibraryTab)</b>
<b class="nc">&nbsp;                                                  .noneMatch(ltab -&gt; ((LibraryTab) ltab).getBibDatabaseContext().getUid().equals(activeUID));</b>
<b class="nc">&nbsp;                    if (wasClosed) {</b>
<b class="nc">&nbsp;                        tabbedPane.getSelectionModel().selectNext();</b>
&nbsp;                    }
&nbsp;                }
&nbsp;
&nbsp;                // All databases are closed or an unknown tab is selected
<b class="nc">&nbsp;                stateManager.setActiveDatabase(null);</b>
<b class="nc">&nbsp;                stateManager.activeTabProperty().set(Optional.empty());</b>
<b class="nc">&nbsp;                stateManager.setSelectedEntries(List.of());</b>
<b class="nc">&nbsp;                mainStage.titleProperty().unbind();</b>
<b class="nc">&nbsp;                mainStage.setTitle(FRAME_TITLE);</b>
&nbsp;            }
&nbsp;        });
&nbsp;
<b class="nc">&nbsp;        BindingsHelper.bindBidirectional((ObservableValue&lt;Boolean&gt;) stateManager.getEditorShowing(), panelMode,</b>
<b class="nc">&nbsp;                mode -&gt; stateManager.getEditorShowing().setValue(mode == PanelMode.MAIN_TABLE_AND_ENTRY_EDITOR),</b>
<b class="nc">&nbsp;                showing -&gt; panelMode.setValue(showing ? PanelMode.MAIN_TABLE_AND_ENTRY_EDITOR : PanelMode.MAIN_TABLE));</b>
<b class="nc">&nbsp;        EasyBind.subscribe(panelMode, mode -&gt; {</b>
<b class="nc">&nbsp;            updateEditorPane();</b>
<b class="nc">&nbsp;            if (mode == PanelMode.MAIN_TABLE_AND_ENTRY_EDITOR) {</b>
<b class="nc">&nbsp;                entryEditor.requestFocus();</b>
&nbsp;            }
&nbsp;        });
&nbsp;
&nbsp;        // Hide tab bar
<b class="nc">&nbsp;        stateManager.getOpenDatabases().addListener((ListChangeListener&lt;BibDatabaseContext&gt;) _ -&gt; updateTabBarVisible());</b>
<b class="nc">&nbsp;        tabbedPane.getTabs().addListener((ListChangeListener&lt;Tab&gt;) _ -&gt; updateTabBarVisible());</b>
&nbsp;
<b class="nc">&nbsp;        stateManager.canGoBackProperty().bind(</b>
<b class="nc">&nbsp;                stateManager.activeTabProperty().flatMap(</b>
&nbsp;                        optionalTab -&gt; optionalTab
<b class="nc">&nbsp;                                .map(LibraryTab::canGoBackProperty)</b>
<b class="nc">&nbsp;                                .orElse(new SimpleBooleanProperty(false))</b>
&nbsp;                )
&nbsp;        );
&nbsp;
<b class="nc">&nbsp;        stateManager.canGoForwardProperty().bind(</b>
<b class="nc">&nbsp;                stateManager.activeTabProperty().flatMap(</b>
&nbsp;                        optionalTab -&gt; optionalTab
<b class="nc">&nbsp;                                .map(LibraryTab::canGoForwardProperty)</b>
<b class="nc">&nbsp;                                .orElse(new SimpleBooleanProperty(false))</b>
&nbsp;                )
&nbsp;        );
&nbsp;    }
&nbsp;
&nbsp;    private void updateTabBarVisible() {
&nbsp;        // When WelcomeTab is open, the tabbar should be visible
<b class="nc">&nbsp;        if (preferences.getWorkspacePreferences().shouldHideTabBar() &amp;&amp; tabbedPane.getTabs().size() &lt;= 1) {</b>
<b class="nc">&nbsp;            if (!tabbedPane.getStyleClass().contains(&quot;hide-tab-bar&quot;)) {</b>
<b class="nc">&nbsp;                tabbedPane.getStyleClass().add(&quot;hide-tab-bar&quot;);</b>
&nbsp;            }
&nbsp;        } else {
<b class="nc">&nbsp;            tabbedPane.getStyleClass().remove(&quot;hide-tab-bar&quot;);</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    /* ************************************************************************
&nbsp;     *
&nbsp;     * Public API
&nbsp;     *
&nbsp;     **************************************************************************/
&nbsp;
&nbsp;    /**
&nbsp;     * Returns a list of all LibraryTabs in this frame.
&nbsp;     */
&nbsp;    public @NonNull ObservableList&lt;LibraryTab&gt; getLibraryTabs() {
<b class="nc">&nbsp;        return EasyBind.map(tabbedPane.getTabs().filtered(LibraryTab.class::isInstance), LibraryTab.class::cast);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Returns the currently viewed LibraryTab.
&nbsp;     */
&nbsp;    public LibraryTab getCurrentLibraryTab() {
<b class="nc">&nbsp;        if (tabbedPane.getSelectionModel().getSelectedItem() == null</b>
<b class="nc">&nbsp;                || !(tabbedPane.getSelectionModel().getSelectedItem() instanceof LibraryTab)) {</b>
<b class="nc">&nbsp;            return null;</b>
&nbsp;        }
<b class="nc">&nbsp;        return (LibraryTab) tabbedPane.getSelectionModel().getSelectedItem();</b>
&nbsp;    }
&nbsp;
&nbsp;    public void showLibraryTab(@NonNull LibraryTab libraryTab) {
<b class="nc">&nbsp;        tabbedPane.getSelectionModel().select(libraryTab);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void showWelcomeTab() {
&nbsp;        // The loop iterates through all tabs in tabbedPane to check if a WelcomeTab already exists. If yes, it is selected.
<b class="nc">&nbsp;        for (Tab tab : tabbedPane.getTabs()) {</b>
<b class="nc">&nbsp;            if (!(tab instanceof LibraryTab)) {</b>
<b class="nc">&nbsp;                tabbedPane.getSelectionModel().select(tab);</b>
&nbsp;                return;
&nbsp;            }
&nbsp;        }
&nbsp;        // WelcomeTab not found
&nbsp;
<b class="nc">&nbsp;        WelcomeTab welcomeTab = new WelcomeTab(</b>
<b class="nc">&nbsp;                Injector.instantiateModelOrService(Stage.class),</b>
&nbsp;                this,
&nbsp;                preferences,
&nbsp;                aiService,
&nbsp;                dialogService,
&nbsp;                stateManager,
&nbsp;                fileUpdateMonitor,
&nbsp;                entryTypesManager,
&nbsp;                undoManager,
&nbsp;                clipBoardManager,
&nbsp;                taskExecutor,
&nbsp;                fileHistory,
<b class="nc">&nbsp;                Injector.instantiateModelOrService(BuildInfo.class),</b>
<b class="nc">&nbsp;                preferences.getWorkspacePreferences()</b>
&nbsp;        );
<b class="nc">&nbsp;        tabbedPane.getTabs().add(welcomeTab);</b>
<b class="nc">&nbsp;        tabbedPane.getSelectionModel().select(welcomeTab);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Opens a new tab with existing data.
&nbsp;     * Asynchronous loading is done at {@link LibraryTab#createLibraryTab}.
&nbsp;     * Similar method: {@link OpenDatabaseAction#openTheFile(Path)}
&nbsp;     */
&nbsp;    public void addTab(@NonNull BibDatabaseContext databaseContext, boolean raisePanel) {
<b class="nc">&nbsp;        Objects.requireNonNull(databaseContext);</b>
<b class="nc">&nbsp;        LibraryTab libraryTab = LibraryTab.createLibraryTab(</b>
&nbsp;                databaseContext,
&nbsp;                this,
&nbsp;                dialogService,
&nbsp;                aiService,
&nbsp;                preferences,
&nbsp;                stateManager,
&nbsp;                fileUpdateMonitor,
&nbsp;                entryTypesManager,
&nbsp;                undoManager,
&nbsp;                clipBoardManager,
&nbsp;                taskExecutor);
<b class="nc">&nbsp;        addTab(libraryTab, raisePanel);</b>
&nbsp;    }
&nbsp;
&nbsp;    public void addTab(@NonNull LibraryTab libraryTab, boolean raisePanel) {
<b class="nc">&nbsp;        tabbedPane.getTabs().add(libraryTab);</b>
<b class="nc">&nbsp;        if (raisePanel) {</b>
<b class="nc">&nbsp;            tabbedPane.getSelectionModel().select(libraryTab);</b>
<b class="nc">&nbsp;            tabbedPane.requestFocus();</b>
<b class="nc">&nbsp;            libraryTab.getMainTable().requestFocus();</b>
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        libraryTab.setContextMenu(createTabContextMenuFor(libraryTab));</b>
&nbsp;    }
&nbsp;
&nbsp;    private ContextMenu createTabContextMenuFor(LibraryTab tab) {
<b class="nc">&nbsp;        ContextMenu contextMenu = new ContextMenu();</b>
<b class="nc">&nbsp;        ActionFactory factory = new ActionFactory();</b>
&nbsp;
<b class="nc">&nbsp;        contextMenu.getItems().addAll(</b>
<b class="nc">&nbsp;                factory.createMenuItem(StandardActions.LIBRARY_PROPERTIES, new LibraryPropertiesAction(tab::getBibDatabaseContext, stateManager)),</b>
<b class="nc">&nbsp;                factory.createMenuItem(StandardActions.OPEN_DATABASE_FOLDER, new OpenDatabaseFolder(dialogService, stateManager, preferences, tab::getBibDatabaseContext)),</b>
<b class="nc">&nbsp;                factory.createMenuItem(StandardActions.OPEN_CONSOLE, new OpenConsoleAction(tab::getBibDatabaseContext, stateManager, preferences, dialogService)),</b>
&nbsp;                new SeparatorMenuItem(),
<b class="nc">&nbsp;                factory.createMenuItem(StandardActions.CLOSE_LIBRARY, new CloseDatabaseAction(this, tab, stateManager)),</b>
<b class="nc">&nbsp;                factory.createMenuItem(StandardActions.CLOSE_OTHER_LIBRARIES, new CloseOthersDatabaseAction(tab)),</b>
<b class="nc">&nbsp;                factory.createMenuItem(StandardActions.CLOSE_ALL_LIBRARIES, new CloseAllDatabaseAction()));</b>
&nbsp;
<b class="nc">&nbsp;        return contextMenu;</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean close() {
<b class="nc">&nbsp;        return viewModel.close();</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean closeTab(LibraryTab tab) {
<b class="nc">&nbsp;        return closeTabs(List.of(tab));</b>
&nbsp;    }
&nbsp;
&nbsp;    public boolean closeTabs(@NonNull List&lt;LibraryTab&gt; tabs) {
&nbsp;        // Only accept library tabs that are shown in the tab container
<b class="nc">&nbsp;        List&lt;LibraryTab&gt; toClose = tabs.stream()</b>
<b class="nc">&nbsp;                                       .distinct()</b>
<b class="nc">&nbsp;                                       .filter(getLibraryTabs()::contains)</b>
<b class="nc">&nbsp;                                       .toList();</b>
&nbsp;
<b class="nc">&nbsp;        if (toClose.isEmpty()) {</b>
&nbsp;            // Nothing to do
<b class="nc">&nbsp;            return true;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Ask before closing any tab, if any tab has changes
<b class="nc">&nbsp;        for (LibraryTab libraryTab : toClose) {</b>
<b class="nc">&nbsp;            if (!libraryTab.requestClose()) {</b>
<b class="nc">&nbsp;                return false;</b>
&nbsp;            }
&nbsp;        }
&nbsp;
&nbsp;        // Close after checking for changes and saving all databases
<b class="nc">&nbsp;        for (LibraryTab libraryTab : toClose) {</b>
<b class="nc">&nbsp;            tabbedPane.getTabs().remove(libraryTab);</b>
&nbsp;            // Trigger org.jabref.gui.LibraryTab.onClosed
<b class="nc">&nbsp;            Event.fireEvent(libraryTab, new Event(this, libraryTab, Tab.CLOSED_EVENT));</b>
&nbsp;        }
&nbsp;        // Force group update in the GroupTreeViewModel when all the libraries are closed
<b class="nc">&nbsp;        if (tabbedPane.getTabs().isEmpty()) {</b>
<b class="nc">&nbsp;            stateManager.setActiveDatabase(null);</b>
&nbsp;        }
<b class="nc">&nbsp;        return true;</b>
&nbsp;    }
&nbsp;
&nbsp;    private OpenDatabaseAction getOpenDatabaseAction() {
<b class="nc">&nbsp;        return new OpenDatabaseAction(</b>
&nbsp;                this,
&nbsp;                preferences,
&nbsp;                aiService,
&nbsp;                dialogService,
&nbsp;                stateManager,
&nbsp;                fileUpdateMonitor,
&nbsp;                entryTypesManager,
&nbsp;                undoManager,
&nbsp;                clipBoardManager,
&nbsp;                taskExecutor);
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Refreshes the ui after preferences changes
&nbsp;     */
&nbsp;    public void refresh() {
&nbsp;        // Disabled, because Bindings implement automatic update. Left here as commented out code to guide if something does not work after updating the preferences.
&nbsp;        // getLibraryTabs().forEach(LibraryTab::setupMainPanel);
<b class="nc">&nbsp;        getLibraryTabs().forEach(tab -&gt; tab.getMainTable().getTableModel().resetFieldFormatter());</b>
&nbsp;    }
&nbsp;
&nbsp;    public void openLastEditedDatabases() {
<b class="nc">&nbsp;        List&lt;Path&gt; lastFiles = preferences.getLastFilesOpenedPreferences().getLastFilesOpened();</b>
<b class="nc">&nbsp;        if (lastFiles.isEmpty()) {</b>
&nbsp;            return;
&nbsp;        }
&nbsp;
<b class="nc">&nbsp;        getOpenDatabaseAction().openFiles(lastFiles);</b>
&nbsp;    }
&nbsp;
&nbsp;    @Deprecated
&nbsp;    public Stage getMainStage() {
<b class="nc">&nbsp;        return mainStage;</b>
&nbsp;    }
&nbsp;
&nbsp;    @Override
&nbsp;    public void handleUiCommands(List&lt;UiCommand&gt; uiCommands) {
<b class="nc">&nbsp;        if (uiCommands.stream().anyMatch(UiCommand.Focus.class::isInstance)) {</b>
<b class="nc">&nbsp;            mainStage.toFront();</b>
&nbsp;            return;
&nbsp;        }
<b class="nc">&nbsp;        viewModel.handleUiCommands(uiCommands);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * The action concerned with closing the window.
&nbsp;     */
&nbsp;    static protected class CloseAction extends SimpleCommand {
&nbsp;
&nbsp;        private final JabRefFrame frame;
&nbsp;
<b class="nc">&nbsp;        public CloseAction(JabRefFrame frame) {</b>
<b class="nc">&nbsp;            this.frame = frame;</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void execute() {
<b class="nc">&nbsp;            if (frame.viewModel.close()) {</b>
<b class="nc">&nbsp;                frame.mainStage.close();</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    static protected class CloseDatabaseAction extends SimpleCommand {
&nbsp;
&nbsp;        private final LibraryTabContainer tabContainer;
&nbsp;        private final LibraryTab libraryTab;
&nbsp;
<b class="nc">&nbsp;        public CloseDatabaseAction(LibraryTabContainer tabContainer, LibraryTab libraryTab, StateManager stateManager) {</b>
<b class="nc">&nbsp;            this.tabContainer = tabContainer;</b>
<b class="nc">&nbsp;            this.libraryTab = libraryTab;</b>
<b class="nc">&nbsp;            this.executable.bind(ActionHelper.needsDatabase(stateManager));</b>
&nbsp;        }
&nbsp;
&nbsp;        /**
&nbsp;         * Using this constructor will result in executing the command on the currently open library tab
&nbsp;         */
&nbsp;        public CloseDatabaseAction(LibraryTabContainer tabContainer, StateManager stateManager) {
<b class="nc">&nbsp;            this(tabContainer, null, stateManager);</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void execute() {
<b class="nc">&nbsp;            Platform.runLater(() -&gt; {</b>
<b class="nc">&nbsp;                if (libraryTab == null) {</b>
<b class="nc">&nbsp;                    if (tabContainer.getCurrentLibraryTab() == null) {</b>
<b class="nc">&nbsp;                        LOGGER.error(&quot;No library tab to close&quot;);</b>
&nbsp;                        return;
&nbsp;                    }
<b class="nc">&nbsp;                    tabContainer.closeTab(tabContainer.getCurrentLibraryTab());</b>
&nbsp;                } else {
<b class="nc">&nbsp;                    tabContainer.closeTab(libraryTab);</b>
&nbsp;                }
&nbsp;            });
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    private class CloseOthersDatabaseAction extends SimpleCommand {
&nbsp;
&nbsp;        private final LibraryTab libraryTab;
&nbsp;
<b class="nc">&nbsp;        public CloseOthersDatabaseAction(LibraryTab libraryTab) {</b>
<b class="nc">&nbsp;            this.libraryTab = libraryTab;</b>
<b class="nc">&nbsp;            this.executable.bind(ActionHelper.needsMultipleDatabases(stateManager));</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void execute() {
<b class="nc">&nbsp;            LibraryTab toKeepLibraryTab = Optional.of(libraryTab).get();</b>
<b class="nc">&nbsp;            for (Tab tab : tabbedPane.getTabs()) {</b>
<b class="nc">&nbsp;                LibraryTab libraryTab = (LibraryTab) tab;</b>
<b class="nc">&nbsp;                if (libraryTab != toKeepLibraryTab) {</b>
<b class="nc">&nbsp;                    Platform.runLater(() -&gt; closeTab(libraryTab));</b>
&nbsp;                }
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
<b class="nc">&nbsp;    private class CloseAllDatabaseAction extends SimpleCommand {</b>
&nbsp;
&nbsp;        @Override
&nbsp;        public void execute() {
<b class="nc">&nbsp;            tabbedPane.getTabs().removeIf(t -&gt; t instanceof WelcomeTab);</b>
<b class="nc">&nbsp;            for (Tab tab : tabbedPane.getTabs()) {</b>
<b class="nc">&nbsp;                Platform.runLater(() -&gt; closeTab((LibraryTab) tab));</b>
&nbsp;            }
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;    public static class OpenDatabaseFolder extends SimpleCommand {
&nbsp;
&nbsp;        private final Supplier&lt;BibDatabaseContext&gt; databaseContext;
&nbsp;        private final DialogService dialogService;
&nbsp;        private final GuiPreferences preferences;
&nbsp;
<b class="nc">&nbsp;        public OpenDatabaseFolder(DialogService dialogService, StateManager stateManager, GuiPreferences preferences, Supplier&lt;BibDatabaseContext&gt; databaseContext) {</b>
<b class="nc">&nbsp;            this.dialogService = dialogService;</b>
<b class="nc">&nbsp;            this.preferences = preferences;</b>
<b class="nc">&nbsp;            this.databaseContext = databaseContext;</b>
<b class="nc">&nbsp;            this.executable.bind(needsSavedLocalDatabase(stateManager));</b>
&nbsp;        }
&nbsp;
&nbsp;        @Override
&nbsp;        public void execute() {
<b class="nc">&nbsp;            Optional.of(databaseContext.get()).flatMap(BibDatabaseContext::getDatabasePath).ifPresent(path -&gt; {</b>
&nbsp;                try {
<b class="nc">&nbsp;                    NativeDesktop.openFolderAndSelectFile(path, preferences.getExternalApplicationsPreferences(), dialogService);</b>
&nbsp;                } catch (IOException e) {
<b class="nc">&nbsp;                    LOGGER.info(&quot;Could not open folder&quot;, e);</b>
&nbsp;                }
&nbsp;            });
&nbsp;        }
&nbsp;    }
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2025-09-29 22:51</div>
</div>
</body>
</html>
